<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open ATBP is a multiplayer online battle arena (MOBA) game based on the Adventure Time series. It features 19 unique Champions and intense 3v3 sessions where teams battle to destroy the enemy base.">
    <meta name="keywords" content="Open ATBP, MOBA game, Adventure Time, multiplayer online battle arena, 3v3 game, Champions, game release, video game, Adventure Time Battle Party">
    <meta property="og:title" content="Open ATBP - Multiplayer MOBA Game Based on Adventure Time">
    <meta property="og:description" content="Play Open ATBP, a thrilling MOBA game inspired by Adventure Time. Control one of 19 unique Champions in intense 3v3 battles.">
    <meta property="og:image" content="atbp-bee.png">
    <meta property="og:url" content=""> <!-- Add URL -->
    <meta property="og:type" content="website">
    <meta name="robots" content="index, follow">
    <title>OpenATBP Rankings</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <style>
        #spicy-battle-menu {
            display: flex;
            justify-content: center;
            margin: 1em 0 1em 0;
            font-size: 1.5em;

        }

        #spicy-battle-menu div {
            margin-right: 1em;
            transition: color 0.3s;
        }

        #global-stats-btn,
        #player-search-btn {
            color: grey;
        }

        #leaderboard-btn {
            color: white;
        }

        #spicy-battle-menu div:hover {
            color: white;
        }

        #spicy-battle-menu .active {
            color: white;
            cursor: default;
        }

        #spicy-battle-menu .inactive {
            color: grey;
            cursor: pointer;
        }

        table {
            width: 30%;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            background-color: rgba(21, 45, 82, 0.2);
            margin: auto;
            color: white;
        }

        tr {
            transition: background-color 0.3s;
        }

        tr:hover {
            background-color: #122642;
            cursor: pointer;
        }

        td {
            padding: 10px;
            text-align: center;
        }

        .bottom-border-cell {
            border-bottom: 1px solid #ddd;
        }

        .profile-picture {
            height: 8vh;
            width: auto;
            border-radius: 50%;
        }

        .rank-image {
            height: 7vh;
            width: auto;
        }

        .leaderboard-position {
            font-weight: bold;
            font-size: 2em;
        }

        .top1 {
            color: gold;
        }

        .top2 {
            color: silver;
        }

        .top3 {
            color: #cd7f32;
        }

        #page-header {
            text-align: center;
            color: white;
        }

        #page-header h1 {
            margin-bottom: 0;
        }

        #page-header p {
            margin-top: 0.5em;
        }
    </style>
</head>
<body>
    <div class="navigation">
        <img src="img/atbp-bee.png" id="nav-logo" alt="Open ATBP Logo">
        <a class="navigation-a" href="index.html">DOWNLOAD</a>
        <a class="navigation-a" href="notes.html">PATCH NOTES</a>
        <a class="navigation-a" href="wiki-home.html">WIKI</a>
        <a class="navigation-a" target="_blank" href="https://discord.gg/YzJkPDjZxG">DISCORD SERVER</a>
        <a class="navigation-a" target="_blank" href="https://github.com/OpenATBP/OpenATBP">GITHUB</a>
    </div>
    <div id="page-header">
        <h1>Spicy Battle</h1>
        <p>Scores refresh every x minutes</p>
    </div>
    <div id="spicy-battle-menu">
        <div id="leaderboard-btn">Leaderboard</div>
        <div id="global-stats-btn" class="inactive">Global Stats</div>
        <div id="player-search-btn" class="inactive">Player Search</div>
    </div>
    <div id="leaderboard-section"></div>
    <div id="global-stats-section"></div>
    <div id="player-search-section"></div>
    <script>
        function getPlayerColor(index) {
            let position = index + 1;
            switch (position) {
                case 1:
                    return 'gold';
                    break;
                case 2:
                    return 'silver';
                    break;
                case 3:
                    return '#cd7f32';
                    break;
                default:
                    return 'white';             
            }
        }

        function getRankImage(elo) {
            if (elo > 2433) return 'img/ranks/4-4.png';
            else if (elo > 2225 && elo < 2434) {
                return 'img/ranks/4-3.png';
            } else if (elo > 2017 && elo < 2226) {
                return 'img/ranks/4-2.png';
            } else if (elo > 1809 && elo < 2018) {
                return 'img/ranks/4-1.png';
            } else if (elo > 1600 && elo < 1810) {
                return 'img/ranks/4-0.png';
            } else if (elo > 1538 && elo < 1601) {
                return 'img/ranks/3-3.png';
            } else if (elo > 1475 && elo < 1539) {
                return 'img/ranks/3-2.png';
            } else if (elo > 1412 && elo < 1476) {
                return 'img/ranks/3-1.png';
            } else if (elo > 1348 && elo < 1413) {
                return 'img/ranks/3-0.png';
            } else if (elo > 1282 && elo < 1349) {
                return 'img/ranks/2-2.png';
            } else if (elo > 1215 && elo < 1283) {
                return 'img/ranks/2-1.png';
            } else if (elo > 1147 && elo < 1216) {
                return 'img/ranks/2-0.png';
            } else if (elo > 573) {
                return 'img/ranks/1-1.png';
            } else {
                return 'img/ranks/1-0.png';
            }
        }

        async function displayLeaderboard() {
            try {
                const res = await fetch('https://beta.openatbp.xyz/data/rankings');
                const data = await res.json();

                if (data.length > 0) {
                    const leaderboardSection = document.getElementById('leaderboard-section');
                    if (leaderboardSection) {
                        const table = document.createElement('table');

                        data.forEach((object, index, array) => {
                            let elo = object.player.elo;
                            let dname = object.user.dname;

                            let row = document.createElement('tr');
                            if (index != array.length - 1) row.className = 'bottom-border-cell';

                            let numberCell = document.createElement('td');
                            numberCell.textContent = index + 1;
                            numberCell.className = 'leaderboard-position';
                            numberCell.style.color = getPlayerColor(index);


                            let imageCell = document.createElement('td');
                            let profilePicture = document.createElement('img');
                            profilePicture.setAttribute('src', 'img/profile-icons/180x180_profile_generic.jpg'); // default profile image until actual pfps are implemented
                            profilePicture.className = 'profile-picture';
                            imageCell.appendChild(profilePicture);

                            let nameCell = document.createElement('td');
                            console.log()
                            dname.split(' ').forEach((word, index, array) => {
                                nameCell.appendChild(document.createTextNode(word));
                                if (index < array.length - 1) {
                                    nameCell.appendChild(document.createElement('br'));
                                }
                            });
                            nameCell.style.color = getPlayerColor(index);

                            let eloCell = document.createElement('td');
                            eloCell.textContent = elo;

                            let rankImageCell = document.createElement('td');
                            let rankImage = document.createElement('img');

                            rankImage.setAttribute('src', getRankImage(elo));
                            rankImage.className = 'rank-image';
                            rankImageCell.appendChild(rankImage);

                            row.appendChild(numberCell);
                            row.appendChild(imageCell);
                            row.appendChild(nameCell);
                            row.appendChild(eloCell);
                            row.appendChild(rankImageCell);

                            table.appendChild(row);
                        });
                        leaderboardSection.appendChild(table);
                    }
                }
            } catch (error) {
                console.log(error);
            }
        }

        async function displayGlobalStats() {

        }

        document.addEventListener('DOMContentLoaded', function () {
            const buttons = document.querySelectorAll('#spicy-battle-menu div');
            const sections = document.querySelectorAll('[id$="-section"]'); // Select all sections ending with "-section"

            buttons.forEach(button => {
                button.addEventListener('click', function () {
                    // If the clicked button is already active, do nothing
                    if (this.classList.contains('active')) return;

                    // Remove 'active' class from all buttons and add 'inactive'
                    buttons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.classList.add('inactive');
                    });

                    // Add 'active' class to the clicked button and remove 'inactive'
                    this.classList.add('active');
                    this.classList.remove('inactive');

                    // Get the button's id and corresponding section
                    const btnId = this.id;
                    const sectionId = btnId.split('-btn')[0] + '-section';
                    const clickedSection = document.getElementById(sectionId);

                    // hide all inactive sections
                    sections.forEach(section => {
                        section.style.display = 'none';
                    })

                    // display active section after the button was clicked
                    if (clickedSection) {
                        clickedSection.style.display = 'block';
                    }
                });
            });
        });
        displayLeaderboard()
    </script>
</body>
</html>
