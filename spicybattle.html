<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Open ATBP is a multiplayer online battle arena (MOBA) game based on the Adventure Time series. It features 19 unique Champions and intense 3v3 sessions where teams battle to destroy the enemy base.">
    <meta name="keywords" content="Open ATBP, MOBA game, Adventure Time, multiplayer online battle arena, 3v3 game, Champions, game release, video game, Adventure Time Battle Party">
    <meta property="og:title" content="Open ATBP - Multiplayer MOBA Game Based on Adventure Time">
    <meta property="og:description" content="Play Open ATBP, a thrilling MOBA game inspired by Adventure Time. Control one of 19 unique Champions in intense 3v3 battles.">
    <meta property="og:image" content="atbp-bee.png">
    <meta property="og:url" content="https://www.openatbp.xyz/spicybattle.html">
    <meta property="og:type" content="website">
    <meta name="robots" content="index, follow">
    <title>OpenATBP Spicy Battle</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="img/favicon.png" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
    <style>
        #spicy-battle-menu {
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            margin-top: 1rem;
            font-size: 1.5em;
        }

        #spicy-battle-menu div {
            margin: 1rem;
            transition: color 0.3s;
        }

        #global-stats-btn,
        #player-search-btn {
            color: grey;
        }

        #leaderboard-btn {
            color: white;
        }

        #spicy-battle-menu div:hover {
            color: white;
        }

        #spicy-battle-menu .active {
            color: white;
            cursor: default;
        }

        #spicy-battle-menu .inactive {
            color: grey;
            cursor: pointer;
        }

        #leaderboard-section {
            margin-top: 2rem;
        }

        #leaderboard-section table {
            width: 30%;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            background-color: rgba(21, 45, 82, 0.2);
            margin: auto;
            overflow: hidden;
            color: white;
        }

        #leaderboard-section tr {
            transition: background-color 0.3s;
        }

        #leaderboard-section tr:hover {
            background-color: #122642;
            cursor: pointer;
        }

        #leaderboard-section td {
            padding: 10px;
            text-align: center;
        }

        .bottom-border-cell {
            border-bottom: 1px solid #ddd;
        }

        .profile-picture {
            height: 8vh;
            width: auto;
            border-radius: 50%;
        }

        .rank-image {
            height: 7vh;
            width: auto;
        }

        .leaderboard-position {
            font-weight: bold;
            font-size: 2em;
        }

        .purple-border {
            border-bottom: 2px solid #e600ff;
        }

        .teal-border {
            border-bottom: 2px solid #29dddd;
        }

        .gold-border {
            border-bottom: 2px solid #ffe504;
        }

        .silver-border {
            border-bottom: 2px solid #81acdc;
        }

        .bronze-border {
            border-bottom: 2px solid #ffa900;
        }

        .master-border {
            border-bottom: 2px solid #7b286b;
        }

        .royal-border {
            border-bottom: 2px solid #42c2d9;
        }

        .regular-border {
            border-bottom: 2px solid white;
        }

        .purple {
            color: transparent;
            -webkit-text-stroke: 1px #e600ff;
        }

        .teal {
            color: transparent;
            -webkit-text-stroke: 1px #29dddd;
        }

        .gold {
            color: transparent;
            -webkit-text-stroke: 1px #ffe504;
        }

        .silver {
            color: transparent;
            -webkit-text-stroke: 1px #81acdc;
        }

        .bronze {
            color: transparent;
            -webkit-text-stroke: 1px #ffa900;
        }

        .master {
            color: transparent;
            -webkit-text-stroke: 1px #7b286b;
        }

        .royal {
            color: transparent;
            -webkit-text-stroke: 1px #42c2d9;
        }

        #page-header {
            text-align: center;
            color: white;
        }

        #page-header h1 {
            margin-bottom: 0;
        }

        #page-header p {
            margin-top: 0.5em;
        }

        #global-stats-sorting-select {
            margin: 0 0 1rem 0;
        }

        #global-stats-section {
            color: white;
            display: none;
            flex-direction: column;
            align-items: center;
        }

        .champion-card {
            margin-bottom: 0.5rem;
        }

        .champion-card:nth-child(odd) {
           background-color: rgb(10, 30, 56);
        }

        .champion-card {
            display: flex;
            align-items: center;
            border: 1px solid;
        }

        .champion-card p {
            margin: 0;
        }

        .champion-stats {
            display: flex;
            flex-direction: column;
            margin-left: 0.5rem;
            margin-right: 1rem;
        }

        .champion-stats p:nth-child(1) {
            font-size: 1.5rem;
            font-weight: bold;
        }

        #player-search-section {
            color: white;
            text-align: center;
            display: none;
        }

        @media (max-width: 768px) {
            #leaderboard-section table {
                width: 100%;
                max-width: 100%;
                table-layout: fixed;
            }

            .profile-picture {
                width: 65px;
                height: auto;
            }

            .rank-image {
                width: 50px;
                height: auto;
            }
        }
    </style>
</head>
<body>
    <div id="navigation">
        <a href="https://www.reddit.com/r/battleparty/" target="_blank"><img src="img/reddit.png" alt="r/battleparty" id="reddit-link-img"></a>
        <img src="img/atbp-bee.png" id="nav-logo" alt="Open ATBP Logo">
        <img src="img/menu.png" alt="menu" id="mobile-nav-open-btn">
        <div id="mobile-nav">
            <table>
                <tr>
                    <td><img src="img/close.png" alt="close" id="mobile-nav-close"></td>
                </tr>
                <tr>
                    <td><a href="index.html">DOWNLOAD</a></td>
                </tr>
                <tr>
                    <td><a href="notes.html">PATCH NOTES</a></td>
                </tr>
                <tr>
                    <td><a href="wiki-home.html">WIKI</a></td>
                </tr>
                <tr>
                    <td><a target="_blank" href="https://discord.gg/YzJkPDjZxG">DISCORD SERVER</a></td>
                </tr>
                <tr>
                    <td><a target="_blank" href="https://github.com/OpenATBP/OpenATBP">GITHUB</a></td>
                </tr>
            </table>
        </div>
        <div id="desktop-nav">
            <a class="navigation-a" href="index.html">DOWNLOAD</a>
            <a class="navigation-a" href="notes.html">PATCH NOTES</a>
            <a class="navigation-a" href="wiki-home.html">WIKI</a>
            <a class="navigation-a" target="_blank" href="https://discord.gg/YzJkPDjZxG">DISCORD SERVER</a>
            <a class="navigation-a" target="_blank" href="https://github.com/OpenATBP/OpenATBP">GITHUB</a>
        </div>
    </div>
    <div id="page-header">
        <h1>Spicy Battle</h1>
    </div>
    <div id="spicy-battle-menu">
        <div id="leaderboard-btn">Leaderboard</div>
        <div id="global-stats-btn" class="inactive">Global Stats</div>
        <div id="player-search-btn" class="inactive">Player Search</div>
    </div>
    <div id="leaderboard-section"></div>
    <div id="global-stats-section">
        <p style="margin: 0;">Sorting:</p>
        <select id="global-stats-sorting-select">
            <option selected value="champion">Alphabetical</option>
            <option value="playsPVP">Games played</option>
            <option value="wr">Win rate</option>
            <option value="avgKills">Average kills per game</option>
            <option value="avgDmg">Average damage per game</option>
        </select>
    </div>
    <div id="player-search-section"><h1>Coming soonâ„¢</h1></div>
    <script>
        function getTop50Border(elo) {
            if (elo > 2433) return 'purple-border';
            else if (elo > 2225) return 'teal-border';
            else if (elo > 2017) return 'gold-border';
            else if (elo > 1809) return 'silver-border';
            else if (elo > 1600) return 'bronze-border';
            else if (elo > 1348) return 'master-border';
            else if (elo > 1147) return 'royal-border';
        }

        function getTop50NumberColor(elo) {
            if (elo > 2433) return 'purple';
            else if (elo > 2225) return 'teal';
            else if (elo > 2017) return 'gold';
            else if (elo > 1809) return 'silver';
            else if (elo > 1600) return 'bronze';
            else if (elo > 1348) return 'master';
            else if (elo > 1147) return 'royal';
        }

        function getRankImage(elo) {
            if (elo > 2433) return 'img/ranks/4-4.png';
            else if (elo > 2225) return 'img/ranks/4-3.png';
            else if (elo > 2017) return 'img/ranks/4-2.png';
            else if (elo > 1809) return 'img/ranks/4-1.png';
            else if (elo > 1600) return 'img/ranks/4-0.png';
            else if (elo > 1538) return 'img/ranks/3-3.png';
            else if (elo > 1475) return 'img/ranks/3-2.png';
            else if (elo > 1412) return 'img/ranks/3-1.png';
            else if (elo > 1348) return 'img/ranks/3-0.png';
            else if (elo > 1282) return 'img/ranks/2-2.png';
            else if (elo > 1215) return 'img/ranks/2-1.png';
            else if (elo > 1147) return 'img/ranks/2-0.png';
            else if (elo > 573) return 'img/ranks/1-1.png';
            else return 'img/ranks/1-0.png';
        }

        async function createLeaderboard() {
            try {
                const res = await fetch('https://beta.openatbp.xyz/data/rankings');
                const data = await res.json();

                if (data.length > 0) {
                    const leaderboardSection = document.getElementById('leaderboard-section');
                    if (leaderboardSection) {
                        const table = document.createElement('table');

                        data.forEach((object, index, array) => {
                            let elo = object.player.elo;
                            let dname = object.user.dname;

                            let row = document.createElement('tr'); 

                            let numberCell = document.createElement('td');
                            numberCell.textContent = index + 1;
                            numberCell.className = 'leaderboard-position';

                            let imageCell = document.createElement('td');
                            let profilePicture = document.createElement('img');
                            profilePicture.setAttribute('src', 'img/profile-icons/180x180_profile_generic.jpg'); // default profile image until actual pfps are implemented
                            profilePicture.className = 'profile-picture';
                            imageCell.appendChild(profilePicture);

                            let nameCell = document.createElement('td');
                            dname.split(' ').forEach((word, index, array) => {
                                nameCell.appendChild(document.createTextNode(word));
                                if (index < array.length - 1) {
                                    nameCell.appendChild(document.createElement('br'));
                                }
                            });

                            let eloCell = document.createElement('td');
                            eloCell.textContent = elo;

                            let rankImageCell = document.createElement('td');
                            let rankImage = document.createElement('img');

                            rankImage.setAttribute('src', getRankImage(elo));
                            rankImage.className = 'rank-image';
                            rankImageCell.appendChild(rankImage);

                            // styling based on position
                            let position = index + 1;
                            let borderName = 'regular-border';
                            if (position < 51) {
                                borderName = getTop50Border(elo);
                                numberCell.classList.add(getTop50NumberColor(elo));
                            }
                            row.className = borderName;
                            
                            row.appendChild(numberCell);
                            row.appendChild(imageCell);
                            row.appendChild(nameCell);
                            row.appendChild(eloCell);
                            row.appendChild(rankImageCell);

                            table.appendChild(row);
                        });
                        leaderboardSection.appendChild(table);
                    }
                }
            } catch (error) {
                console.log(error);
            }
        }

        function getChampionImage(avatar) {
            switch (avatar) {
                case "cinnamonbun":
                    return "img/champions/cb.png";
                case "flame":
                    return "img/champions/fp.png";
                case "princessbubblegum":
                    return "img/champions/pb.png";
                case "peppermintbutler":
                    return "img/champions/pepbut.png";
                default:
                    return `img/champions/${avatar}.png`;                 
            }
        }

        function getFormalName(avatar) {
            switch (avatar) {
                case "bmo":
                    return "Beemo";
                case "cinnamonbun":
                    return "Cinnamon Bun";
                case "flame":
                    return "Flame Princess";
                case "iceking":
                    return "Ice King";
                case "lsp": 
                    return "Lumpy Space Princess";
                case "magicman":
                    return "Magic Man";
                case "peppermintbutler":
                    return "Peppermint Butler";
                case "princessbubblegum":  
                    return "Princess Bubblegum";
                default:
                    return avatar.charAt(0).toUpperCase() + avatar.slice(1);                    
            }
        }

        function determineIfObjSmaller(obj, obj2, sorting) {
            switch (sorting) {
                case 'champion': //alphabetical sorting
                    let objChar1 = obj.champion.charCodeAt(0);
                    let obj2Char1 = obj2.champion.charCodeAt(0);
                    let objChar2 = obj.champion.charCodeAt(1);
                    let obj2Char2 = obj2.champion.charCodeAt(1);
                    let objChar3 = obj.champion.charCodeAt(2);
                    let obj2Char3 = obj2.champion.charCodeAt(2);

                    if (objChar1 < obj2Char1) return false;
                    else if (objChar1 > obj2Char1) return true;
                    else if (objChar1 == obj2Char1) {
                        if (objChar2 < obj2Char2) return false;
                        else if (objChar2 > obj2Char2) return true;
                        else if (objChar2 == obj2Char2) {
                            if (objChar3 < obj2Char3) return false;
                            else return true;
                        }
                    }

                case 'playsPVP':
                    let objPlaysPVP = obj.playsPVP;
                    let obj2PlaysPVP = obj2.playsPVP;
                    return objPlaysPVP < obj2PlaysPVP;

                case 'wr':
                    let objPlays = obj.playsPVP;
                    let objWins = obj.winsPVP;

                    let obj2Plays = obj2.playsPVP;
                    let obj2Wins = obj2.winsPVP;
                    
                    let objWr = objPlays > 0 ? Math.round((objWins / objPlays) * 100) : 0; 
                    let obj2Wr = obj2Plays > 0 ? Math.round((obj2Wins / obj2Plays) * 100) : 0;
                    return objWr < obj2Wr;

                case 'avgKills':
                    let objKills = obj.kills;
                    let objDeaths = obj.deaths;

                    let obj2Kills = obj2.kills;
                    let obj2Deaths = obj2.deaths;

                    let objAvgKills = objDeaths > 0 ? (objKills / objDeaths).toFixed(2) : objKills;
                    let obj2AvgKills = obj2Deaths > 0 ? (obj2Kills / obj2Deaths).toFixed(2) : obj2Kills;
                    return objAvgKills < obj2AvgKills;

                case 'avgDmg':
                    let objGames = obj.playsPVP;
                    let objDmg = obj.damage;

                    let obj2Games = obj2.playsPVP;
                    let obj2Dmg = obj2.damage;

                    let objAvgDmg = objGames > 0 ? Math.round(objDmg / objGames) : 0;
                    let obj2AvgDmg = obj2Games > 0 ? Math.round(obj2Dmg / obj2Games) : 0;
                    return objAvgDmg < obj2AvgDmg;
            }
        }

        async function getSortedChampStatsArray(sorting) { 
            try {
                let array = [];
                const res = await fetch('https://beta.openatbp.xyz/data/champstats');
                const data = await res.json();

                if (data.length > 0) {
                    for (let i = 0; i < data.length; i++) {
                        for (let n = 0; n < data.length - 1; n++) {
                            let obj = data[n];
                            let obj2 = data[n + 1];

                            let objSmaller = determineIfObjSmaller(obj, obj2, sorting);
                            if (objSmaller) {
                                let temp = data[n];
                                data[n] = data[n + 1];
                                data[n + 1] = temp;
                            }
                        }
                    }
                    return data;
                }
            } catch (err) {
                console.log(err);
            }
        }

        async function createGlobalStats(sorting) {
            try {
                const data = await getSortedChampStatsArray(sorting);
                const globalStatsSection = document.getElementById('global-stats-section');
                const parentDiv = document.createElement('div');
                parentDiv.setAttribute('id', `${sorting}`);

                if (Array.isArray(data)) {
                    data.forEach((element) => {
                        let champName = element.champion;
                        let playsPVP = element.playsPVP;
                        let winsPVP = element.winsPVP;
                        let kills = element.kills;
                        let deaths = element.deaths;
                        let assists = element.assists;
                        let damage = element.damage;

                        let div = document.createElement('div');
                        div.className = 'champion-card';
                        
                        let wr = playsPVP > 0 ? Math.round((winsPVP / playsPVP) * 100) : 0;
                        let avgKills = deaths > 0 ? (kills / deaths).toFixed(2) : kills;
                        let avgDmg = playsPVP > 0 ? Math.round(damage / playsPVP) : 0;

                        let championImage = getChampionImage(champName);
                        let formalName = getFormalName(champName);
                        
                        div.innerHTML = `
                            <img src="${championImage}">
                            <div class="champion-stats">
                                <p>${formalName}</p>
                                <p>Games played: ${playsPVP}</p>
                                <p>Win rate: ${wr}%</p>
                                <p>Average kills per game: ${avgKills}</p>
                                <p>Average damage per game: ${avgDmg}</p>
                            </div>
                        `;
                        parentDiv.appendChild(div);
                    });
                    globalStatsSection.appendChild(parentDiv);
                }
            } catch (error) {
                console.log(error);
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const buttons = document.querySelectorAll('#spicy-battle-menu div');
            const sections = document.querySelectorAll('[id$="-section"]'); // Select all sections ending with "-section"

            buttons.forEach(button => {
                button.addEventListener('click', function () {
                    // If the clicked button is already active, do nothing
                    if (this.classList.contains('active')) return;

                    // Remove 'active' class from all buttons and add 'inactive'
                    buttons.forEach(btn => {
                        btn.classList.remove('active');
                        btn.classList.add('inactive');
                    });

                    // Add 'active' class to the clicked button and remove 'inactive'
                    this.classList.add('active');
                    this.classList.remove('inactive');

                    // Get the button's id and corresponding section
                    const btnId = this.id;
                    const sectionId = btnId.split('-btn')[0] + '-section';
                    const clickedSection = document.getElementById(sectionId);

                    // hide all inactive sections
                    sections.forEach(section => {
                        section.style.display = 'none';
                    })

                    // display active section after the button was clicked
                    if (clickedSection) {
                        switch (sectionId) {
                            case 'global-stats-section':
                                clickedSection.style.display = 'flex';
                                if (clickedSection.children.length < 3) {
                                    let defaultSorting = 'champion'; //alphabetical sorting
                                    createGlobalStats(defaultSorting);
                                }
                                break;
                            
                            case 'leaderboard-section':
                                clickedSection.style.display = 'block';
                                break;

                            case 'player-search-section':
                                clickedSection.style.display = 'block';    
                        }
                    }
                });
            });

            const select = document.getElementById('global-stats-sorting-select');

            select.addEventListener('change', () => {
                let option = select.value;
                let sortedSection = document.getElementById(option);

                if (!sortedSection) {
                    createGlobalStats(option); // create global stats with the selected sorting option
                } else {
                    sortedSection.style.display = 'block';
                }

                let allSortedSections = ['champion', 'playsPVP', 'wr', 'avgKills', 'avgDmg'];
                const index = allSortedSections.indexOf(option);

                if (index > -1) allSortedSections.splice(index, 1);

                allSortedSections.forEach((id) => {
                    let element = document.getElementById(id);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
            });
        });
        createLeaderboard();
    </script>
    <script type="text/javascript" src="mobile-nav-handler.js" ></script>
</body>
</html>